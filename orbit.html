

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>A closer look at orbit integration &mdash; galpy v0.1 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="galpy v0.1 documentation" href="index.html" />
    <link rel="next" title="Action-angle coordinates" href="actionAngle.html" />
    <link rel="prev" title="Two-dimensional disk distribution functions" href="basic_df.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="actionAngle.html" title="Action-angle coordinates"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basic_df.html" title="Two-dimensional disk distribution functions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">galpy v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo-small.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">A closer look at orbit integration</a><ul>
<li><a class="reference internal" href="#orbit-initialization">Orbit initialization</a></li>
<li><a class="reference internal" href="#orbit-integration">Orbit integration</a></li>
<li><a class="reference internal" href="#displaying-the-orbit">Displaying the orbit</a></li>
<li><a class="reference internal" href="#orbit-characterization">Orbit characterization</a></li>
<li><a class="reference internal" href="#accessing-the-raw-orbit">Accessing the raw orbit</a></li>
<li><a class="reference internal" href="#fast-orbit-integration">Fast orbit integration</a></li>
<li><a class="reference internal" href="#example-the-eccentricity-distribution-of-the-milky-way-s-thick-disk">Example: The eccentricity distribution of the Milky Way&#8217;s thick disk</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="basic_df.html"
                        title="previous chapter">Two-dimensional disk distribution functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="actionAngle.html"
                        title="next chapter">Action-angle coordinates</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/orbit.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="a-closer-look-at-orbit-integration">
<h1>A closer look at orbit integration<a class="headerlink" href="#a-closer-look-at-orbit-integration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="orbit-initialization">
<h2>Orbit initialization<a class="headerlink" href="#orbit-initialization" title="Permalink to this headline">¶</a></h2>
<p>Orbits can be initialized in various coordinate frames. The simplest
initialization gives the initial conditions directly in the
Galactocentric cylindrical coordinate frame (or in the rectangular
coordinate frame in one dimension). <tt class="docutils literal"><span class="pre">Orbit()</span></tt> automatically figures
out the dimensionality of the space from the initial conditions in
this case. In three dimensions initial conditions are given either as
<tt class="docutils literal"><span class="pre">vxvv=[R,vR,vT,z,vz,phi]</span></tt> or one can choose not to specify the
azimuth of the orbit and initialize with
<tt class="docutils literal"><span class="pre">vxvv=[R,vR,vT,z,vz]</span></tt>. Since potentials in galpy are easily
initialized to have a circular velocity of one at a radius equal to
one, initial coordinates are best given as a fraction of the radius at
which one specifies the circular velocity, and initial velocities are
best expressed as fractions of this circular velocity. For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">vxvv</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
</pre></div>
</div>
<p>initializes a fully three-dimensional orbit, while</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">vxvv</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
</pre></div>
</div>
<p>initializes an orbit in which the azimuth is not tracked, as might be
useful for axisymmetric potentials.</p>
<p>In two dimensions, we can similarly specify fully two-dimensional
orbits <tt class="docutils literal"><span class="pre">vxvv=[R,vR,vT,phi]</span></tt> or choose not to track the azimuth and
initialize as <tt class="docutils literal"><span class="pre">vxvv=[R,vR,vT]</span></tt>.</p>
<p>In one dimension we simply initialize as <tt class="docutils literal"><span class="pre">vxvv=[x,vx]</span></tt>.</p>
<p>For orbit integration and characterization of observed stars or
clusters, initial conditions can also be specified directly as
observed quantities when <tt class="docutils literal"><span class="pre">radec=True</span></tt> is set. In this case a full
three-dimensional orbit is initialized as
<tt class="docutils literal"><span class="pre">vxvv=[RA,Dec,distance,pmRA,pmDec,Vlos]</span></tt> where RA and Dec are
expressed in degrees, the distance is expressed in kpc, proper motions
are expressed in mas/yr (pmra = pmra&#8217; * cos[Dec] ), and the
line-of-sight velocity is given in km/s. These observed coordinates
are translated to the Galactocentric cylindrical coordinate frame by
assuming a Solar motion that can be specified as either
<tt class="docutils literal"><span class="pre">solarmotion=hogg</span></tt> (default; <a class="reference external" href="http://adsabs.harvard.edu/abs/2005ApJ...629..268H">2005ApJ...629..268H</a>),
<tt class="docutils literal"><span class="pre">solarmotion=dehnen</span></tt> (<a class="reference external" href="http://adsabs.harvard.edu/abs/1998MNRAS.298..387D">1998MNRAS.298..387D</a>) or
<tt class="docutils literal"><span class="pre">solarmotion=shoenrich</span></tt> (<a class="reference external" href="http://adsabs.harvard.edu/abs/2010MNRAS.403.1829S">2010MNRAS.403.1829S</a>). A circular
velocity can be specified as <tt class="docutils literal"><span class="pre">vo=235</span></tt> in km/s and a value for the
distance between the Galactic center and the Sun can be given as
<tt class="docutils literal"><span class="pre">ro=8.5</span></tt> in kpc. While the inputs are given in physical units, the
orbit is initialized assuming a circular velocity of one at the
distance of the Sun.</p>
<p>When <tt class="docutils literal"><span class="pre">radec=True</span></tt> is set, velocities can also be specified in
Galactic coordinates if <tt class="docutils literal"><span class="pre">UVW=True</span></tt> is set. The input is then
<tt class="docutils literal"><span class="pre">vxvv=[RA,Dec,distance,U,V,W]</span></tt>, where the velocities are expressed
in km/s. U is, as usual, defined as -vR (minus vR).</p>
</div>
<div class="section" id="orbit-integration">
<h2>Orbit integration<a class="headerlink" href="#orbit-integration" title="Permalink to this headline">¶</a></h2>
<p>After an orbit is initialized, we can integrate it for a set of times
<tt class="docutils literal"><span class="pre">ts</span></tt>, given as a numpy array. For example, in a simple logarithmic
potential we can do the following</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">galpy.potential</span> <span class="kn">import</span> <span class="n">LogarithmicHaloPotential</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lp</span><span class="o">=</span> <span class="n">LogarithmicHaloPotential</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">vxvv</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">lp</span><span class="p">)</span>
</pre></div>
</div>
<p>to integrate the orbit from <tt class="docutils literal"><span class="pre">t=0</span></tt> to <tt class="docutils literal"><span class="pre">t=100</span></tt>, saving the orbit at
10000 instances.</p>
</div>
<div class="section" id="displaying-the-orbit">
<h2>Displaying the orbit<a class="headerlink" href="#displaying-the-orbit" title="Permalink to this headline">¶</a></h2>
<p>After integrating the orbit, it can be displayed by using the
<tt class="docutils literal"><span class="pre">plot()</span></tt> function. The quantities that are plotted when <tt class="docutils literal"><span class="pre">plot()</span></tt>
is called depend on the dimensionality of the orbit: in 3D the (R,z)
projection of the orbit is shown; in 2D either (X,Y) is plotted if the
azimuth is tracked and (R,vR) is shown otherwise; in 1D (x,vx) is
shown. E.g., for the example given above,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>gives</p>
<img alt="_images/lp-orbit-integration.png" src="_images/lp-orbit-integration.png" />
<p>Other projections of the orbit can be displayed by specifying the
quantities to plot. E.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d1</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>gives the projection onto the plane of the orbit:</p>
<img alt="_images/lp-orbit-integration-xy.png" src="_images/lp-orbit-integration-xy.png" />
<p>while</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d1</span><span class="o">=</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s">&#39;vR&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>gives the projection onto (R,vR):</p>
<img alt="_images/lp-orbit-integration-RvR.png" src="_images/lp-orbit-integration-RvR.png" />
<p>We can also plot the orbit in other coordinate systems such as
Galactic longitude and latitude</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s">&#39;k.&#39;</span><span class="p">,</span><span class="n">d1</span><span class="o">=</span><span class="s">&#39;ll&#39;</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s">&#39;bb&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>which shows</p>
<img alt="_images/lp-orbit-integration-lb.png" src="_images/lp-orbit-integration-lb.png" />
<p>or RA and Dec</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s">&#39;k.&#39;</span><span class="p">,</span><span class="n">d1</span><span class="o">=</span><span class="s">&#39;ra&#39;</span><span class="p">,</span><span class="n">d2</span><span class="o">=</span><span class="s">&#39;dec&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/lp-orbit-integration-radec.png" src="_images/lp-orbit-integration-radec.png" />
<p>See the documentation of the o.plot function and the o.ra(), o.ll(),
etc. functions on how to provide the necessary parameters for the
coordinate transformations.</p>
</div>
<div class="section" id="orbit-characterization">
<h2>Orbit characterization<a class="headerlink" href="#orbit-characterization" title="Permalink to this headline">¶</a></h2>
<p>The properties of the orbit can also be found using galpy. For
example, we can calculate the peri- and apocenter radii of an orbit,
its eccentricity, and the maximal height above the plane of the orbit</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">rap</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">rperi</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">e</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">zmax</span><span class="p">()</span>
<span class="go">(1.2581455175173673,0.97981663263371377,0.12436710999105324,0.11388132751079502)</span>
</pre></div>
</div>
<p>We can also calculate the energy of the orbit, either in the potential
that the orbit was integrated in, or in another potential:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">E</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">E</span><span class="p">(</span><span class="n">pot</span><span class="o">=</span><span class="n">mp</span><span class="p">)</span>
<span class="go">(0.6150000000000001, -0.67390625000000015)</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">mp</span></tt> is the Miyamoto-Nagai potential of <a class="reference internal" href="getting_started.html#rotcurves"><em>Introduction:
Rotation curves</em></a>.</p>
<p>We can also show the energy as a function of time (to check energy
conservation)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plotE</span><span class="p">()</span>
</pre></div>
</div>
<p>gives</p>
<img alt="_images/lp-orbit-integration-E.png" src="_images/lp-orbit-integration-E.png" />
<p>We can specify another quantity to plot the energy against by
specifying <tt class="docutils literal"><span class="pre">d1=</span></tt>. We can also show the vertical energy, for example,
as a function of R</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plotEz</span><span class="p">(</span><span class="n">d1</span><span class="o">=</span><span class="s">&#39;R&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/lp-orbit-integration-Ez.png" src="_images/lp-orbit-integration-Ez.png" />
<p>Often, a better approximation to an integral of the motion is given by
Ez/sqrt(density[R]). We refer to this quantity as <tt class="docutils literal"><span class="pre">EzJz</span></tt> and we can plot its
behavior</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">plotEzJz</span><span class="p">(</span><span class="n">d1</span><span class="o">=</span><span class="s">&#39;R&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/lp-orbit-integration-EzJz.png" src="_images/lp-orbit-integration-EzJz.png" />
</div>
<div class="section" id="accessing-the-raw-orbit">
<h2>Accessing the raw orbit<a class="headerlink" href="#accessing-the-raw-orbit" title="Permalink to this headline">¶</a></h2>
<p>The value of <tt class="docutils literal"><span class="pre">R</span></tt>, <tt class="docutils literal"><span class="pre">vR</span></tt>, <tt class="docutils literal"><span class="pre">vT</span></tt>, <tt class="docutils literal"><span class="pre">z</span></tt>, <tt class="docutils literal"><span class="pre">vz</span></tt>, <tt class="docutils literal"><span class="pre">x</span></tt>, <tt class="docutils literal"><span class="pre">vx</span></tt>,
<tt class="docutils literal"><span class="pre">y</span></tt>, <tt class="docutils literal"><span class="pre">vy</span></tt>, <tt class="docutils literal"><span class="pre">phi</span></tt>, and <tt class="docutils literal"><span class="pre">vphi</span></tt> at any time can be obtained by
calling the corresponding function with as argument the time (the same
holds for other coordinates <tt class="docutils literal"><span class="pre">ra</span></tt>, <tt class="docutils literal"><span class="pre">dec</span></tt>, <tt class="docutils literal"><span class="pre">pmra</span></tt>, <tt class="docutils literal"><span class="pre">pmdec</span></tt>,
<tt class="docutils literal"><span class="pre">vra</span></tt>, <tt class="docutils literal"><span class="pre">vdec</span></tt>, <tt class="docutils literal"><span class="pre">ll</span></tt>, <tt class="docutils literal"><span class="pre">bb</span></tt>, <tt class="docutils literal"><span class="pre">pmll</span></tt>, <tt class="docutils literal"><span class="pre">pmbb</span></tt>, <tt class="docutils literal"><span class="pre">vll</span></tt>,
<tt class="docutils literal"><span class="pre">vbb</span></tt>, <tt class="docutils literal"><span class="pre">vlos</span></tt>, <tt class="docutils literal"><span class="pre">dist</span></tt>, <tt class="docutils literal"><span class="pre">helioX</span></tt>, <tt class="docutils literal"><span class="pre">helioY</span></tt>, <tt class="docutils literal"><span class="pre">helioZ</span></tt>,
<tt class="docutils literal"><span class="pre">U</span></tt>, <tt class="docutils literal"><span class="pre">V</span></tt>, and <tt class="docutils literal"><span class="pre">W</span></tt>). If no time is given the initial condition is
returned, and if a time is requested at which the orbit was not saved
spline interpolation is used to return the value. Examples include</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="go">1.1545076874679474</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mf">99.</span><span class="p">)</span>
<span class="go">88.105603035901169</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">ra</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span><span class="n">obs</span><span class="o">=</span><span class="p">[</span><span class="mf">8.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">ro</span><span class="o">=</span><span class="mf">8.</span><span class="p">)</span>
<span class="go">array([ 285.76403985])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">helioX</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span>
<span class="go">array([ 1.24888927])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">pmll</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="n">obs</span><span class="o">=</span><span class="p">[</span><span class="mf">8.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">245.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">ro</span><span class="o">=</span><span class="mf">8.</span><span class="p">,</span><span class="n">vo</span><span class="o">=</span><span class="mf">230.</span><span class="p">)</span>
<span class="go">array([-6.45263888])</span>
</pre></div>
</div>
<p>We can also initialize an <tt class="docutils literal"><span class="pre">Orbit</span></tt> instance using the phase-space
position of another <tt class="docutils literal"><span class="pre">Orbit</span></tt> instance evaulated at time t. For
example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">newOrbit</span><span class="o">=</span> <span class="n">o</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span>
</pre></div>
</div>
<p>will initialize a new Orbit instance with as initial condition the phase-space position of orbit <tt class="docutils literal"><span class="pre">o</span></tt> at <tt class="docutils literal"><span class="pre">time=10.</span></tt>.</p>
<p>The whole orbit can also be obtained using the function <tt class="docutils literal"><span class="pre">getOrbit</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">.</span><span class="n">getOrbit</span><span class="p">()</span>
</pre></div>
</div>
<p>which returns a matrix of phase-space points with dimensions [ntimes,ndim].</p>
</div>
<div class="section" id="fast-orbit-integration">
<h2>Fast orbit integration<a class="headerlink" href="#fast-orbit-integration" title="Permalink to this headline">¶</a></h2>
<p>The standard orbit integration is done purely in python using standard
scipy integrators. When fast orbit integration is needed for batch
integration of a large number of orbits, a set of orbit integration
routines are written in C that can be accessed for most potentials, as
long as they have C implementations, which can be checked by using the
attribute <tt class="docutils literal"><span class="pre">hasC</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mp</span><span class="o">=</span> <span class="n">MiyamotoNagaiPotential</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mf">0.0375</span><span class="p">,</span><span class="n">amp</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mp</span><span class="o">.</span><span class="n">hasC</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Fast C integrators can be accessed through the <tt class="docutils literal"><span class="pre">method=</span></tt> keyword of
the <tt class="docutils literal"><span class="pre">orbit.integrate</span></tt> method. Currently available integrators are</p>
<ul class="simple">
<li>rk4_c</li>
<li>rk6_c</li>
<li>dopr54_c</li>
</ul>
<p>which are Runge-Kutta and Dormand-Prince methods. There are also a
number of symplectic integrators available</p>
<ul class="simple">
<li>leapfrog_c</li>
<li>symplec4_c</li>
<li>symplec6_c</li>
</ul>
<p>The higher order symplectic integrators are described in <a class="reference external" href="http://adsabs.harvard.edu/abs/1993CeMDA..56...27Y">Yoshida
(1993)</a>.</p>
<p>For most applications I recommend <tt class="docutils literal"><span class="pre">dopr54_c</span></tt>. For example, compare</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o</span><span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">vxvv</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timeit</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">mp</span><span class="p">))</span>
<span class="go">1 loops, best of 3: 553 ms per loop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timeit</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">mp</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;dopr54_c&#39;</span><span class="p">))</span>
<span class="go">galpyWarning: Using C implementation to integrate orbits</span>
<span class="go">10 loops, best of 3: 25.6 ms per loop</span>
</pre></div>
</div>
<p>As this example shows, galpy will issue a warning that C is being
used. Speed-ups by a factor of 20 are typical.</p>
</div>
<div class="section" id="example-the-eccentricity-distribution-of-the-milky-way-s-thick-disk">
<h2>Example: The eccentricity distribution of the Milky Way&#8217;s thick disk<a class="headerlink" href="#example-the-eccentricity-distribution-of-the-milky-way-s-thick-disk" title="Permalink to this headline">¶</a></h2>
<p>A straightforward application of galpy&#8217;s orbit initialization and
integration capabilities is to derive the eccentricity distribution of
a set of thick disk stars. We start by downloading the sample of SDSS
SEGUE (<a class="reference external" href="http://adsabs.harvard.edu/abs/2009AJ....137.4377Y">2009AJ....137.4377Y</a>) thick disk
stars compiled by Dierickx et al. (<a class="reference external" href="http://adsabs.harvard.edu/abs/2010arXiv1009.1616D">2010arXiv1009.1616D</a>) at</p>
<p><a class="reference external" href="http://www.mpia-hd.mpg.de/homes/rix/Data/Dierickx-etal-tab2.txt">http://www.mpia-hd.mpg.de/homes/rix/Data/Dierickx-etal-tab2.txt</a></p>
<p>After reading in the data (RA,Dec,distance,pmRA,pmDec,vlos; see above)
as a vector <tt class="docutils literal"><span class="pre">vxvv</span></tt> with dimensions [6,ndata] we (a) define the
potential in which we want to integrate the orbits, and (b) integrate
each orbit and save its eccentricity (running this for all 30,000-ish
stars will take about half an hour)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">lp</span><span class="o">=</span> <span class="n">LogarithmicHaloPotential</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span><span class="o">=</span> <span class="n">nu</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">20.</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mye</span><span class="o">=</span> <span class="n">nu</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)):</span>
<span class="gp">... </span>        <span class="n">o</span><span class="o">=</span> <span class="n">Orbit</span><span class="p">(</span><span class="n">vxvv</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span><span class="n">radec</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">vo</span><span class="o">=</span><span class="mf">220.</span><span class="p">,</span><span class="n">ro</span><span class="o">=</span><span class="mf">8.</span><span class="p">)</span> <span class="c">#Initialize</span>
<span class="gp">... </span>        <span class="n">o</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">lp</span><span class="p">)</span> <span class="c">#Integrate</span>
<span class="gp">... </span>        <span class="n">mye</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">e</span><span class="p">()</span> <span class="c">#Calculate eccentricity</span>
</pre></div>
</div>
<p>We then find the following eccentricity distribution</p>
<img alt="_images/dierickx-myehist.png" src="_images/dierickx-myehist.png" />
<p>The eccentricity calculated by galpy compare well with those
calculated by Dierickx et al., except for a few objects</p>
<img alt="_images/dierickx-myee.png" src="_images/dierickx-myee.png" />
<p>The script that calculates and plots everything can be downloaded
<a class="reference download internal" href="_downloads/dierickx-edist.py"><tt class="xref download docutils literal"><span class="pre">here</span></tt></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="actionAngle.html" title="Action-angle coordinates"
             >next</a> |</li>
        <li class="right" >
          <a href="basic_df.html" title="Two-dimensional disk distribution functions"
             >previous</a> |</li>
        <li><a href="index.html">galpy v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010 - 2013, Jo Bovy.
      Last updated on Jan 09, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>